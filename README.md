# mj-server

<center><font color=#ff0000 size=8 face="黑体">麻将和牌判断</font></center>

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

## 查表法


- 所有能和的牌型事先都是一致的，可以预先放入map。
- 遍历的方法效率较低，查表的效率要高。

```
基础查表法是给每种牌编个ID，34种牌需要至少6位空间。手牌14张共84位。
要保存和牌的全部组合约1700万种需要约175MB存储。
```

暴力拆解比较吃计算
查表法比较吃内存

** 虽然这两者对于当今的PC都不是问题，但如果平台机能特别有限，可以采用改进的查表法。**


- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -



## 改进的查表法


- 牌型如何编码?
- 如何完整、无误地枚举所有和牌类型?
- 表如何存储，如何查询？


- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -


## 牌型编码
 
### 基础变换
```
「１２３」→「１１１」
「５６７」→「１１１」
「１１１」→「３」
「３３３」→「３」
「２３４４５６」→「１１２１１」
「６７一二西西」→「１１０１１０２」
```

### 牌型变换
```

「１２３５６７一二三五六七西西」→「１１１０１１１０１１１０１１１０２」

「１１１２３４６７８東東東西西」→「３１１１０１１１０３０２」

「１１１２２２２３３３３４４４」→「３４４３」

「１３５７９一三五七九東南西北」→「１０１０１０１０１０１０１０１０１０１０１０１０１０１」

```

### 二进制编码
```
「１」→「０」
「２」→「１１０」
「３」→「１１１１０」
「４」→「１１１１１１０」
「１０」→「１０」
「２０」→「１１１０」
「３０」→「１１１１１０」
「４０」→「１１１１１１１０」
```

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -


## 编码例子


```
 「１３５７９ 一 三 五 七 九 東 南 西 北」
→「１０１０１０１０１０１０１０１０１０１０１０１０１０１」
→「１０１０１０１０１０１０１０１０１０１０１０１０１０１」    （符号化前）
→「１０１０１０１０１０１０１０１０１０１０１０１０１００」    （符号化后）


 「 2 2 2     4 5 6     三 四 五 六  七  八    北 北   」
→「   3    0  1 1 1  0  1  1  1  1  1  1   0   2     」（符号化前）
→「 11111  0  0 0 1  0  0  0  0  0  0  1   0   1 1 0 」（符号化后）

```

- 
<font color=#ff0000 size=4 face="黑体">容易看出，这样编码后每张牌只占用1到2位空间，最恶情况子下（十四张不连单牌）仅占用27位。跟之前的84位相比，数据只有其三分之一。
</font>
- 
<font color=#ff0000 size=4 face="黑体">和牌表从1700万种具体组合下降到仅仅9362种形状排列。</font>

** 优化后的查表算法比暴力拆解快大约50倍，而且速度稳定。相对地，传统的拆解法碰上清一色这种同色牌多的牌型会变慢。**



- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -


